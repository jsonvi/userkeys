<html>
  <script>

function getKeys(_domain,_callback) {
    if(localStorage[_domain]) {
        var result = JSON.parse(localStorage[_domain]);
        _callback(result);
    } else {
        var xhr = new XMLHttpRequest();
        var url = "https://raw.github.com/jsonvi/userkeys/master/keysettings/"+ _domain +".json"
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                  var result = JSON.parse(xhr.responseText);
                  _callback(result);
                  localStorage[_domain] = xhr.responseText;
                } else {
                  _callback(null);
                }
          }
        }
        xhr.send();
    }
}

chrome.extension.onRequest.addListener(function(request,sender,sendResponse) {
    switch (request.action) {
        case "getkeys":
            getKeys(request.domain,sendResponse);
            break;
        default:
            break;
    }
});

  </script>
</html>
